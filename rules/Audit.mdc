âœ… Zasada audytu: Lokalizacja problemu na schemacie przepÅ‚ywu danych
Aby poprawnie zgÅ‚osiÄ‡, przeanalizowaÄ‡ lub naprawiÄ‡ problem w procesie generowania flashcards, kaÅ¼dy audyt musi zawieraÄ‡ jednoznaczne wskazanie miejsca wystÄ…pienia bÅ‚Ä™du na schemacie przepÅ‚ywu danych.

ğŸ” Schemat przepÅ‚ywu danych
Kod
Postman (localhost:3000/api/generations)
    â†“ POST z source_text
Astro API Proxy (src/pages/api/generations.ts)
    â†“ Mapowanie: source_text â†’ text
    â†“ POST do Supabase Edge Function
Supabase Edge Function (localhost:54321/functions/v1/generate-flashcards)
    â†“ Walidacja danych
    â†“ Konstrukcja promptu dla AI
    â†“ POST do OpenRouter.ai
OpenRouter.ai API (https://openrouter.ai/api/v1/chat/completions)
    â†“ Model: amazon/nova-2-lite-v1:free
    â†“ Generacja flashcards
    â†“ Response z JSON
Supabase Edge Function
    â†“ Parsowanie odpowiedzi AI
    â†“ Walidacja flashcards
    â†“ INSERT do PostgreSQL
    â†“ Response z proposals
Astro API Proxy
    â†“ Response
Postman
âœ… Wymagania audytu
KaÅ¼dy audyt powinien zawieraÄ‡:

1. LokalizacjÄ™ problemu
WskaÅ¼ dokÅ‚adny etap lub podetap, np.:

Postman â†’ bÅ‚Ä™dny payload

Astro API Proxy â†’ mapowanie source_text â†’ text

Edge Function â†’ walidacja danych wejÅ›ciowych

Edge Function â†’ konstrukcja promptu

Edge Function â†’ request do OpenRouter.ai

OpenRouter.ai â†’ bÅ‚Ä™dny JSON

Edge Function â†’ parsowanie odpowiedzi

Edge Function â†’ walidacja flashcards

Edge Function â†’ zapis do PostgreSQL

2. Opis objawu
PrzykÅ‚ady:

bÅ‚Ä…d HTTP (np. 400, 422, 500)

niepoprawny JSON

brak danych w odpowiedzi

niepoprawna walidacja

timeout

bÅ‚Ä™dny insert do bazy

3. WpÅ‚yw na dalsze etapy
Np.:

flashcards nie sÄ… generowane

brak zapisu do bazy

pipeline zatrzymuje siÄ™ przed walidacjÄ…

response do klienta jest pusty lub bÅ‚Ä™dny

âœ… Jakie dane naleÅ¼y dostarczyÄ‡ do analizy
Aby audyt byÅ‚ moÅ¼liwy do wykonania, zgÅ‚oszenie musi zawieraÄ‡ komplet danych diagnostycznych:

A. Dane wejÅ›ciowe
Payload wysÅ‚any z Postmana (peÅ‚ny JSON)

Headers (szczegÃ³lnie Content-Type, Authorization jeÅ›li dotyczy)

B. Logi z poszczegÃ³lnych etapÃ³w
Logi Astro API Proxy (jeÅ›li dostÄ™pne)

Logi Supabase Edge Function (peÅ‚ne, nie wycinki)

Logi bÅ‚Ä™dÃ³w z OpenRouter.ai (jeÅ›li zwrÃ³cone)

C. Dane z odpowiedzi
Surowy response z Astro API Proxy

Surowy response z Edge Function

Surowy response z OpenRouter.ai

D. Fragmenty kodu (jeÅ›li istotne)
mapowanie danych

konstrukcja promptu

walidacja danych

parsowanie JSON

insert do bazy

E. Dane z bazy (opcjonalnie)
rekordy, ktÃ³re zostaÅ‚y zapisane lub niepoprawnie zapisane

struktura tabel, jeÅ›li problem dotyczy schematu

F. Zrzuty ekranu / screenshoty
Postman (request + response)

logi z terminala

dashboard Supabase (jeÅ›li dotyczy)

âœ… PrzykÅ‚ad uÅ¼ycia zasady
Lokalizacja problemu: Supabase Edge Function â†’ Parsowanie odpowiedzi AI

Objaw: Model zwraca JSON w formacie string, ktÃ³ry nie przechodzi JSON.parse().

Dostarczone dane:

payload z Postmana

log z Edge Function: Unexpected token '}' in JSON at position 312

surowy response z OpenRouter.ai

WpÅ‚yw: Flashcards nie sÄ… walidowane ani zapisywane do bazy.